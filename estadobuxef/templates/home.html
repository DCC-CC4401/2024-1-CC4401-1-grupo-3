{% extends 'base.html' %}
{% load static %}
{% block title %} Menú Principal {% endblock %}

{% block css %}
    <link rel="stylesheet" type="text/css" href="{% static 'css/home.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'css/cat.css' %}">
{% endblock %}

{% block javascript %}
    <script src="{% static 'js/home.js' %}" type="text/javascript">
    </script>
{% endblock %}

{% block content %}
    <div>
        <div class="container" >
            <h2 class="reports-title" style="color: #040430">ÚLTIMOS REPORTES</h2>
            <table class="table" >
                <tr >
                    <th style="color: #040430">Lugar</th>
                    <th style="color: #040430">Suceso</th>
                    <th style="color: #040430">Hora</th>
                    <th style="color: #040430">Estado</th>
                    {% if user_is_funcionario %}
                    <th></th>
                    {% endif %}
                </tr>
                {% if reportes %}
                    {% for reporte in reportes %}
                        <tr>
                            <td class="reporte-lugar" style="color: #040430"><a href="{% url 'lugar' %}?nombre={{ reporte.lugar.nombre }}">{{ reporte.lugar.nombre }}</a></td>
                            <td style="color: #040430">{{ reporte.contenido }}</td>
                            <td style="color: #040430">{{ reporte.hora|date:"H:i" }}</td>
                            <td class="reporte-estado" style="color: #040430">{{ reporte.estado }}</td>
                            {% if user_is_funcionario %}
                                <td class="edit-btn" style="color: #040430"><span onclick="changeState(this, {{ reporte.id }})" class="material-symbols-outlined" style="cursor:pointer">edit</span></td>
                            {% endif %}
                        </tr>
                    {% endfor %}
                {% endif %}
            </table>
            <a class="not-btn" href="{% url 'reports' %}" style="color: #040430">Ver más</a>
        </div>

        <div>
            <button onclick="myFunction()" class="dropdown" id="ingresar-btn">Ingresar Reporte</button>
            <div id="add-report" class="add-report">
                {% if user.is_authenticated %}
                    <form method="post">
                        {% csrf_token %}
                        <div id="lugar">
                            <label for="lugar">Lugar: </label>
                            <select id="lugar" name="lugar">
                                <option value="null">Seleccione lugar del suceso</option>
                                {% for lugar in lugares %}
                                    <option value="{{ lugar.id }}">{{ lugar.nombre }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div id="suceso">
                            <label for="contenido">Suceso:</label>
                            <textarea id="contenido" name="contenido"></textarea>
                        </div>
                        <div>
                            <button type="submit">Enviar</button>
                        </div>
                    </form>
                {% else %}
                    <p>Para publicar reportes debe
                        <a href="{% url 'log-reg' %}?form=signup" class="not-btn">registrarse</a>
                    </p>
                {% endif %}
            </div>
        </div>
    <div  style="margin: 21px 0; text-align: center">
    <h2 class="reports-title" style="color: #040430">LUGARES</h2>
    <div class="categories-container">
        {% for categoria in categorias %}
            <div class="category">
                <img src="{% static 'images/categories' %}/{{ categoria.foto }}">
                <h2 style="color: #040430">{{ categoria.nombre }}</h2>
                    <ul>
                        {% for lugar in lugares.all %}
                            {% if lugar.categoria == categoria %}
                            <li style="color: #040430"><a href="{% url 'lugar' %}?nombre={{  lugar.nombre }}">{{ lugar.nombre }}</a></li>
                            {% endif %}
                        {% endfor %}
                    </ul>
            </div>
        {% endfor %}
    </div>
    </div>
    </div>
    <script>
        function myFunction() {
            document.getElementById("add-report").classList.toggle("show");
            document.getElementById("ingresar-btn").classList.toggle("active");
        }
    </script>
{% endblock %}